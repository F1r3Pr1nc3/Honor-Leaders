namespace = new_honor_leader
# All - on_game_start_country - Create Clone leaders
country_event = {
	id = new_honor_leader.1000
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
	}
	immediate = {
		export_trigger_value_to_variable = { trigger = num_owned_leaders variable = tot_leaders }
		while = {
			count = tot_leaders
			random_owned_leader = {
				limit = {
					NOR = {
						leader_class = envoy 
						has_leader_flag = honor_clone_created 
					}
				}
				set_leader_flag = honor_clone_created
				save_event_target_as = hon_clone
				# set_leader_flag = honor_clone_created
				owner = {
					clone_leader = {
						target = event_target:hon_clone
						effect = {
							set_immortal = yes
							save_global_event_target_as = honor_copy_@event_target:hon_clone
							exile_leader_as = clone_leader_test
							log = "NAME: [this.GetName]"
						}
					}
				}
			}
		}
		clear_variable = tot_leaders
	}
	after = {
		country_event = { id = new_honor_leader.1005 days = 2 }
	}
}

# Scope: Leader (after assignment)
# All - on_leader_assigned - Create Clone leader for new leaders
leader_event = {
	id = new_honor_leader.1001
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			is_ai = no
			is_regular_empire = yes
		}
		NOT = { has_leader_flag = honor_clone_created }
	}
	immediate = {
		set_leader_flag = honor_clone_created
		save_event_target_as = new_leader_clone
		owner = {
			clone_leader = {
				target = prev
				effect = {
					set_immortal = yes
					save_global_event_target_as = honor_copy_@prev
					exile_leader_as = clone_leader_test
				}
			}
		}
	}
}

# All - on_ruler_set - Set Reign Begin Date Flags
country_event = {
	id = new_honor_leader.1005
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
		days_passed > 1
	}
	immediate = {
		# Consider adding event that lets you set term start date for auths
		if = {
			limit = { NOT = { exists = event_target:honor_copy_@ruler } }
			ruler = {
				owner = {
					clone_leader = {
						target = prev
						effect = {
							set_immortal = yes
							save_global_event_target_as = honor_copy_@prev
							exile_leader_as = clone_leader_test
						}
					}
				}
			}
		}
		event_target:honor_copy_@ruler = {
			if = {
				limit = { NOT = { is_variable_set = stints_as_ruler } }
				set_variable = { which = stints_as_ruler value = 1 }
				if = { limit = { days_passed < 7 }
					root.ruler = { set_leader_flag = first_ruler }
				}
			} else = {
				change_variable = { which = stints_as_ruler value = 1 }
			}
			get_ruler_term_begin_number = yes
		}
	}
}

# Executed when a ruler has been removed
# From = Previous Ruler
# This = Country
# ALL - on_ruler_back_to_pre_ruler_class - Set Reign End Date Flags
country_event = {
	id = new_honor_leader.1010
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
	}
	immediate = {
		event_target:honor_copy_@from = { get_ruler_term_end_number = yes }
	}
}

# ALL - on_election_ended - Set Reign End Date Flag for first ruler
country_event = {
	id = new_honor_leader.1015
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
		ruler = { NOT = { has_leader_flag = first_ruler } }
		any_owned_leader = { has_leader_flag = first_ruler }
	}
	immediate = {
		random_owned_leader = {
			limit = { has_leader_flag = first_ruler }
			remove_leader_flag = first_ruler
			event_target:honor_copy_@this = {
				set_saved_date = {
					key = ruler_stint_end_date_1
					days_from_present = 0
				}
			}
		}
	}
}

# Executed just as country is changing its government, before the new one is applied
# THIS = country
# ALL - on_post_government_changed - Reset Stints
country_event = {
	id = new_honor_leader.1100
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
		exists = ruler
	}
	immediate = {
		event_target:honor_copy_@ruler = { subtract_variable = { which = stints_as_ruler value = 1 } }
	}
}

# ALL - on_monthly_pulse_country - Set months as Ruler
country_event = {
	id = new_honor_leader.1200
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		is_regular_empire = yes
		exists = ruler
	}
	immediate = {
		event_target:honor_copy_@ruler = {
			if = { limit = { NOT = { is_variable_set = months_as_ruler } }
				set_variable = { which = months_as_ruler value = 1 }
			} else = {
				change_variable = { which = months_as_ruler value = 1 }
			}
		}
	}
}
